<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-02-09 Wed 11:41 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Designing Data-Intensive Applications</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="chrischen" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css">
</head>
<body>
<div id="content">
<h1 class="title">Designing Data-Intensive Applications</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9e3ba17">1. Overviews</a>
<ul>
<li><a href="#org12079a6">1.1. Functionalities</a></li>
<li><a href="#org2dfcc43">1.2. Questions</a></li>
<li><a href="#org4d670b5">1.3. Factors Influence the Design</a></li>
<li><a href="#orge6b19fc">1.4. Reliability</a></li>
<li><a href="#org911089d">1.5. Scalability</a></li>
<li><a href="#orgb8cca16">1.6. Maintainability</a></li>
<li><a href="#org99d43a9">1.7. A Simple Architecture</a></li>
</ul>
</li>
<li><a href="#orgcea13ba">2. Data Models</a>
<ul>
<li><a href="#orgb6a5f8d">2.1. Relational Model</a></li>
<li><a href="#orgd4d6e76">2.2. Document Model</a></li>
<li><a href="#org3ba498d">2.3. Graph-Like Data Models</a></li>
<li><a href="#org0df2c2a">2.4. Other Models</a></li>
<li><a href="#orge141118">2.5. Query Languages</a></li>
<li><a href="#org22adc45">2.6. Summary</a></li>
</ul>
</li>
<li><a href="#org9f1c894">3. Tools</a></li>
</ul>
</div>
</div>
<div id="outline-container-org9e3ba17" class="outline-2">
<h2 id="org9e3ba17"><span class="section-number-2">1</span> Overviews</h2>
<div class="outline-text-2" id="text-1">
<p>
Many applications today are data-intensive, as opposed to compute-intensive.
</p>
</div>

<div id="outline-container-org12079a6" class="outline-3">
<h3 id="org12079a6"><span class="section-number-3">1.1</span> Functionalities</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li>Store data (databases)</li>
<li>Remember the result of an expensive operation (caches)</li>
<li>Allow users to search data by filter (search indexes)</li>
<li>Send a message to another process, to be handled asynchronously (stream processing)</li>
<li>Periodically crunch a large amount of accumulated data (batch processing)</li>
</ul>
</div>
</div>

<div id="outline-container-org2dfcc43" class="outline-3">
<h3 id="org2dfcc43"><span class="section-number-3">1.2</span> Questions</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>How do you ensure that the data remains correct and complete?</li>
<li>How do you provide consistently good performance to clients?</li>
<li>How do you scale to handle an increase in load?</li>
<li>What does a good API for the service look like?</li>
</ul>
</div>
</div>

<div id="outline-container-org4d670b5" class="outline-3">
<h3 id="org4d670b5"><span class="section-number-3">1.3</span> Factors Influence the Design</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>Skills and experience of the people involved</li>
<li>Legacy system dependencies</li>
<li>The timescale for delivery</li>
<li><b>Organization's tolerance of different kinds of risk</b></li>
<li>Regulatory constraints</li>
</ul>
</div>
</div>

<div id="outline-container-orge6b19fc" class="outline-3">
<h3 id="orge6b19fc"><span class="section-number-3">1.4</span> Reliability</h3>
<div class="outline-text-3" id="text-1-4">
<p>
The system should continue to work correctly (performing the correct function at
the desired level of performance) even in the face of adversity (hardware or
software faults, and even human error).
</p>
</div>

<div id="outline-container-orgb8121c7" class="outline-4">
<h4 id="orgb8121c7">Fault vs. Failure</h4>
<div class="outline-text-4" id="text-orgb8121c7">
<dl class="org-dl">
<dt>Fault</dt><dd>Fault is defined as one component of the system deviating from its spec.</dd>
<dt>Failure</dt><dd>Failure is when the system as a whole stops providing the required service to the user.</dd>
</dl>
</div>
</div>

<div id="outline-container-orgeb0344e" class="outline-4">
<h4 id="orgeb0344e">Hardware Faults</h4>
<div class="outline-text-4" id="text-orgeb0344e">
<ul class="org-ul">
<li>Add redundancy to reduce the failure rate.</li>
<li>A single-server system requires planned downtime if you need to reboot the machine
(to apply operating system security patches, for example).</li>
<li>Multi-machine redundancy was only required by a small number of applications for
which high availability was absolutely essential.</li>
<li>Hardware faults are thought of random and independent from each other.</li>
<li>Tolerate the loss of entire machines, by using software <b>fault-tolerance techniques in preference</b>.</li>
</ul>
</div>
</div>

<div id="outline-container-org46a5990" class="outline-4">
<h4 id="org46a5990">Software Errors</h4>
<div class="outline-text-4" id="text-org46a5990">
<ul class="org-ul">
<li>Systematic errors tend to cause many more system failures than uncorrelated hardware faults.</li>
<li>Examples of systematic errors:
<ul class="org-ul">
<li>A software bug that causes every instance of an application server to crash when given a particular bad input.</li>
<li>A runaway process that uses up some shared resource.</li>
<li>A service that the system depends on that slows down, becomes unresponsive, or starts returning corrupted responses.</li>
<li>Cascading failures, where a small fault in one component triggers a fault in another component, which in turn triggers
further faults.</li>
</ul></li>
<li>Solutions
<ul class="org-ul">
<li>Carefully thinking about assumptions and interactions in the system</li>
<li><b>Thorough Testing</b></li>
<li>Process Isolation</li>
<li>Allowing processes to crash and restart</li>
<li>Measuring, monitoring, and analyzing system behavior in production</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org8a001a2" class="outline-4">
<h4 id="org8a001a2">Human Errors</h4>
<div class="outline-text-4" id="text-org8a001a2">
<p>
Approaches to deal with unreliable humans
</p>
<ul class="org-ul">
<li>Well-designed abstractions, APIs and <b>admin interfaces</b></li>
<li>Decouple the places where people make the most mistakes from the places where they can cause failures.</li>
<li>Sandbox environments to help explore and experiment safely using real data.</li>
<li>Test thoroughly at all levels, from unit tests to whole-system integration tests and manual tests.</li>
<li>Allow quick and easy recovery from human errors.</li>
<li>Set up detailed and clear monitoring, such as performance metrics and error rates.</li>
<li>Implement good management practices and training</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org911089d" class="outline-3">
<h3 id="org911089d"><span class="section-number-3">1.5</span> Scalability</h3>
<div class="outline-text-3" id="text-1-5">
<p>
As the system grows (in data volume, traffic volume, or complexity), there
should be reasonable ways of dealing with that growth.
</p>
</div>

<div id="outline-container-orgf7021c2" class="outline-4">
<h4 id="orgf7021c2">Describing Load</h4>
<div class="outline-text-4" id="text-orgf7021c2">
<p>
Load parameter Example:
</p>
<ul class="org-ul">
<li>Requests per second</li>
<li>The ratio of reads to writes in a database</li>
<li>The hit rate on a cache</li>
<li>The number of simultaneously active users in a chat room</li>
<li>Twitter: The distribution of followers per user (maybe weighted by how often those users tweet) is a key load parameter
for discussing scalability, since it determines the fan-out load.</li>
</ul>
</div>
</div>

<div id="outline-container-org53fc610" class="outline-4">
<h4 id="org53fc610">Describing Performance</h4>
<div class="outline-text-4" id="text-org53fc610">
</div>
<ul class="org-ul">
<li><a id="orgb943b22"></a>Look at it in two ways<br />
<div class="outline-text-5" id="text-orgb943b22">
<ul class="org-ul">
<li>When you increase a load parameter and keep the system resources unchanged, how is the performance of your system affected?</li>
<li>When you increase a load parameter, how much do you need to increase the resources if you want to keep performance unchanged?</li>
</ul>
</div>
</li>

<li><a id="org3be1b1e"></a>Performance Examples<br />
<div class="outline-text-5" id="text-org3be1b1e">
<dl class="org-dl">
<dt>Throughput</dt><dd>The number of records we can process per second, or the total time it takes to run a job on a dataset of a certain size. (Important for batch processing system)</dd>
<dt>Response Time</dt><dd>The time between a client sending a request and receiving a response. (Important for online systems)</dd>
<dt>Latency</dt><dd>Latency is the duration that a request is waiting to be handled—during which it is latent, awaiting service.
<ul class="org-ul">
<li>The causes of outliers: context switch, the loss of a network packet, a garbage collection pause, a page fault forcing a read from disk, etc.</li>
<li>Amazon describes response time requirements for internal services in terms of the 99.9th percentile,
even though it only affects 1 in 1,000 requests. This is because the customers with the slowest requests
are often those who have the most data on their accounts</li>
<li>Reducing response times at very high percentiles is difficult because they are easily affected by random
events outside of your control, and the benefits are diminishing.</li>
</ul></dd>
</dl>
</div>
</li>
</ul>
</div>

<div id="outline-container-org60a7490" class="outline-4">
<h4 id="org60a7490">Coping with Load</h4>
<div class="outline-text-4" id="text-org60a7490">
<p>
Recommended Practices
</p>
<ul class="org-ul">
<li>keep your database on a single node (scale up) until scaling cost or high-availability
requirements forced you to make it distributed.</li>
<li>An architecture that scales well for a particular application is built around assumptions
of which operations will be common and which will be rare—the load parameters.</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgb8cca16" class="outline-3">
<h3 id="orgb8cca16"><span class="section-number-3">1.6</span> Maintainability</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Over time, many different people will work on the system (engineering and operations,
both maintaining current behavior and adapting the system to new use cases), and
they should all be able to work on it productively.
</p>
</div>

<div id="outline-container-orga25e4d1" class="outline-4">
<h4 id="orga25e4d1">Operability</h4>
<div class="outline-text-4" id="text-orga25e4d1">
<p>
Make it easy for operations teams to keep the system running smoothly.
</p>
<ul class="org-ul">
<li>Monitoring the health of the system and quickly restoring service if it goes into a bad state</li>
<li>Tracking down the cause of problems</li>
<li>Keeping software and platforms up to date, including security patches</li>
<li>Establishing good practices and tools for deployment, configuration management, and more</li>
<li>Defining processes that make operations predictable and help keep the production environment stable</li>
<li>Preserving the organization's knowledge about the system, even as individual people come and go</li>
</ul>
</div>
</div>

<div id="outline-container-orgcd4d00c" class="outline-4">
<h4 id="orgcd4d00c">Simplicity</h4>
<div class="outline-text-4" id="text-orgcd4d00c">
<p>
Make it easy for new engineers to understand the system, by removing as much complexity as possible from the system.
</p>
<ul class="org-ul">
<li>Complexities
<ul class="org-ul">
<li>Explosion of the state space</li>
<li>Tight coupling of modules</li>
<li>Tangled dependencies</li>
<li>Inconsistent naming and terminology</li>
<li>etc&#x2026;</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org0826c6f" class="outline-4">
<h4 id="org0826c6f">Evolvability</h4>
<div class="outline-text-4" id="text-org0826c6f">
<p>
Make it easy for engineers to make changes to the system in the future, adapting it for unanticipated use cases as requirements change.
</p>
</div>
</div>
</div>

<div id="outline-container-org99d43a9" class="outline-3">
<h3 id="org99d43a9"><span class="section-number-3">1.7</span> A Simple Architecture</h3>
<div class="outline-text-3" id="text-1-7">

<div id="org84e9c9f" class="figure">
<p><img src="../resources/DDIA/simple_data_system_architecture.png" alt="simple_data_system_architecture.png" />
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgcea13ba" class="outline-2">
<h2 id="orgcea13ba"><span class="section-number-2">2</span> Data Models</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>The advantage of using an <b>ID</b> is that because it has no meaning to humans, it <b>never needs to change</b>.</li>
</ul>
</div>

<div id="outline-container-orgb6a5f8d" class="outline-3">
<h3 id="orgb6a5f8d"><span class="section-number-3">2.1</span> Relational Model</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>The roots of relational databases lie in business data processing.</li>
<li>Schema-on-write (where the schema is explicit and the database ensures all written data conforms to it)</li>
</ul>
</div>
</div>

<div id="outline-container-orgd4d6e76" class="outline-3">
<h3 id="orgd4d6e76"><span class="section-number-3">2.2</span> Document Model</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>Support <b>self-contained</b> document</li>
<li>Many-to-one and many-to-many relationships don't fit nicely into document model</li>
<li>Better performance due to <b>locality</b></li>
<li>The application need to do additional work to keep the denormalized data consistent and emulate the join operation.</li>
<li>Schema-on-read (the structure of the data is implicit, and only interpreted when the data is read)</li>
</ul>
</div>

<div id="outline-container-org029092c" class="outline-4">
<h4 id="org029092c">When to Use</h4>
<div class="outline-text-4" id="text-org029092c">
<ul class="org-ul">
<li>There are many different types of objects, and it is not practical to put each type of object in its own table.</li>
<li>The structure of the data is determined by external systems over which you have no control and which may change at any time.</li>
<li>When your application has mostly one-to-many relationships (tree-structured data) or no relationships between records</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org3ba498d" class="outline-3">
<h3 id="org3ba498d"><span class="section-number-3">2.3</span> Graph-Like Data Models</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>Graphs are good for <b>evolvability</b>.</li>
<li>Property Graph Model (Neo4j, Titan and InfiniteGraph)</li>
<li>Triple-Store Model (Datomic, AllegroGraph)</li>
<li>Query Lanaguages (Cypher, SPARQL, and Datalog)</li>
</ul>
</div>
</div>

<div id="outline-container-org0df2c2a" class="outline-3">
<h3 id="org0df2c2a"><span class="section-number-3">2.4</span> Other Models</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li>GenBank for genome data</li>
<li>Large Hadron Collider (LHC) for particle physicists</li>
<li>Full-text search</li>
</ul>
</div>
</div>

<div id="outline-container-orge141118" class="outline-3">
<h3 id="orge141118"><span class="section-number-3">2.5</span> Query Languages</h3>
<div class="outline-text-3" id="text-2-5">
<ul class="org-ul">
<li>Declarative
<ul class="org-ul">
<li>Hides implementation details of the database engine</li>
</ul></li>
<li>Imperative</li>
</ul>
</div>

<div id="outline-container-org917c774" class="outline-4">
<h4 id="org917c774">MapReduce in MongoDB</h4>
<div class="outline-text-4" id="text-org917c774">
<div class="org-src-container">
<pre class="src src-js">db.users.mapReduce<span style="color: #3a81c3;">(</span>
    <span style="color: #3a81c3; font-weight: bold;">function</span> <span style="color: #6c3163; font-weight: bold;">map</span><span style="color: #6c3163;">()</span> <span style="color: #6c3163;">{</span>
        <span style="color: #3a81c3; font-weight: bold;">var</span> <span style="color: #715ab1;">age</span> = <span style="color: #4e3163;">this</span>.age;
        emit<span style="color: #2d9574;">(</span>age, <span style="color: #4e3163;">this</span>.height<span style="color: #2d9574;">)</span>; <span style="color: #2aa1ae; background-color: #ecf3ec;">// </span><span style="color: #2aa1ae; background-color: #ecf3ec;">emit(key, value)</span>
    <span style="color: #6c3163;">}</span>,
    <span style="color: #3a81c3; font-weight: bold;">function</span> <span style="color: #6c3163; font-weight: bold;">reduce</span><span style="color: #6c3163;">(</span><span style="color: #715ab1;">key</span>, <span style="color: #715ab1;">values</span><span style="color: #6c3163;">)</span> <span style="color: #6c3163;">{</span>
        <span style="color: #3a81c3; font-weight: bold;">return</span> Array.avg<span style="color: #2d9574;">(</span>values<span style="color: #2d9574;">)</span>;
    <span style="color: #6c3163;">}</span>,
    <span style="color: #6c3163;">{</span>
        query: <span style="color: #2d9574;">{</span> gender: <span style="color: #2d9574;">"male"</span><span style="color: #2d9574;">}</span>,
        out: <span style="color: #2d9574;">"AvgHeightReport"</span>
    <span style="color: #6c3163;">}</span>
<span style="color: #3a81c3;">)</span>;
</pre>
</div>
<ul class="org-ul">
<li><code>map</code> and <code>reduce</code> functions should be pure functions (no side effect). This allow the database to run the functions anywhere, in any order, and rerun them on failure.</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org22adc45" class="outline-3">
<h3 id="org22adc45"><span class="section-number-3">2.6</span> Summary</h3>
<div class="outline-text-3" id="text-2-6">
<ul class="org-ul">
<li>Document databases target use cases where data comes in self-contained documents and relationships between one document and another are <b>rare</b>.</li>
<li>Graph databases go in the opposite direction, targeting use cases where anything is potentially related to everything.</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org9f1c894" class="outline-2">
<h2 id="org9f1c894"><span class="section-number-2">3</span> Tools</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>Redis
<ul class="org-ul">
<li>datastore also used as message queue</li>
</ul></li>
<li>Kafka
<ul class="org-ul">
<li>message queue with database-like <b>durability guarantees</b>.</li>
</ul></li>
</ul>
</div>
</div>
</div>
</body>
</html>
