#+TITLE: AI for Trading
#+OPTIONS: H:3 toc:2 num:3 ^:nil
#+AUTHOR: ChrisChen
#+EMAIL: ChrisChen3121@gmail.com

* Financial Data
** Data Types
*** Market Data
    - Tick Data
      - Quote Data: bid, bid size, ask, ask size
      - Trade Data: last trade, volume
    - OHLC: open, high, low, close
    - Orderbook
    - Transaction

*** Corporate Actions
    - Stock Splits
    - Cash Dividends: Partial cash distribution of company earnings.
      - Symbol, Ex-Dividend Date, Dividend, Record Date, Announcement Date, Payment Date
      - Adjusted Price Factor: $1+D/S$  D: Dividend  S: Stock price at ex-dividend date
      - Divide the historical price by the adjusted price factor to normalize.
    - ...

*** Alternative Data
    - Social Media Posts: can convey sentiment towards companies.
    - News Articles: can shape investor opinion.
    - Satellite Images: used to estimate crop yield.
    - Consumer Data: can predict sales and revenue long before official announcements.

* Fundamental Analysis
** Data Sources
   (usually updated every quarter)
  - Balance Sheet
  - Cash Flow Statements

** PE ratio
  Price to Earnings Ratio. It’s important to be careful about how we interpret a high or low PE ratio.
  The market price of a share is based on the collective estimates by investors of the company’s *current equity* plus its *future earnings*.
  The future earnings are based on estimates of future cash flow, which are then adjusted to their present-day value, or *Present Value* (PV).
  - High PE ratio: A company may have low or negative earnings, but a high stock price due to the estimated future earnings.
  - Low PE ratio: may be a company has high and stable earnings, but less expectations for future growth.

** Other Key Factors
  - Sales Per Share(Revenue is the same)
  - Earnings Per Share
    - Earnings gives investors a sense of how much the equity of the company has changed over the past 3 months.
  - Dividends Per Share


** Key Points
  - Try to analyze a collection of different measures over time.
  - Can be used as risk factors.

* Returns
  $$RawReturn(r) = \frac{p_t - p_{t-1}}{p_{t-1}}$$
  $$LogReturn(R) = ln(p_t/p_{t-1})$$
** Relations between Raw and Log
   $$LogReturn=ln(RawReturn+1)$$
   $$RawReturn=e^{LogReturn}-1$$

** Continuous Compounding
   - Compounding Formula
   $$p_t=p_{t-1}(1+\frac{r}{n})^n$$
   - Now make *n* bigger and bigger
   $$\lim_{n \to \infty}(1+\frac{r}{n})^n=e^r$$
   - Compounding infinitely often is called *continuous compounding*
   $$100\times e^{0.04}=104.08$$
   - Reverse the previous calculation
   $$104.08/100=e^r$$
   $$r=ln(104.08/100)=0.04$$
   - r is the *continuously compounded return*. It is just the *log return*

*** Additivity
    Annual rate of *continuous compounding* is simply the sum of the monthly rates.
    - invest $100 for two years with a monthly  continuously compounded interest rate was 2%
    $$100\times{e^{0.02}}\times{e^{0.02}}... = 100\times{e^{(0.02+0.02+...)}}=100\times{e^{0.24}}=127.12$$
    - Time Additivity of Log Returns. *log return for Jan and Feb = log return for Jan + log return for Feb*
    $$ln(\frac{p_{Mar 1}}{p_{Jan 1}}) = ln(\frac{p_{Mar 1}}{p_{Feb 1}}) + ln(\frac{p_{Feb 1}}{p_{Jan 1}})$$

*** Annualized Rate of Return
    If we just had a single monthly rate, but we assumed that the rates for all the months of the year were the same,
    we could /extrapolate/ the monthly rate to an annual rate by multiplying by 12. This is called *annualizing the
    rate of continuous compounding*.
    $$LogReturn(Y)=\sum_{M=1}^{12} LogReturn(M)=MeanOfLogReturn(M)\times 12$$
    $$RawReturn(Y)=e^{LogReturn(Y)}-1$$

** Compounding
   - rate of interest of 4%
   | Compounding Frequency | Value of $100 after 1 year |
   |-----------------------+----------------------------|
   | Annually(n=1)         | $104.00                    |
   | Quarterly(n=4)        | $104.06                    |
   | Weekly(n=52)          | $104.08                    |
   | Daily(n=252)          | $104.08                    |

** Distribution of Returns
   The conversation about the best model for the distribution of returns has been going on for at least the past century.
   The best model will depend on exactly what your analysis seeks to achieve.
   [[../resources/MOOC/Trading/returns_distributions.png]]

** Why Log Returns?
   1. Log returns can be interpreted as *continuously compounded returns*.
   1. Log returns are time-additive. The multi-period log return is simply the sum of single period log returns.
   1. The use of log returns prevents security prices from becoming negative in models of security returns.
   1. log returns of a security can be reasonably modeled as distributed according to a normal distribution. ?
   1. When returns and log returns are small, their values are approximately equal.
   1. Logarithms can help make an algorithm more *numerically stable*.

* Indicators
** Overlap Studies
*** Bollinger Bands
   [[../resources/MOOC/Trading/bollinger_bands.png]]

** Momentum Indicators
   - moving averages
   - large price movements with volume
   - stocks making new highs

* Trading Strategies
** Types of Trading Strategies
   1. Single Asset Strategies
   2. Pairwise Strategies
   3. Cross-sectional Strategies(statistical arbitrage, market neutral investing): use group of assets
   4. Alternative Data Based Strategies: Satellite Imagery, Social Media, Geolocation, Consumer Transaction Data

   Large hedge funds are most interested in 3 and 4, large hedge funds seek:
   - High capacity -> 3
   - New, different ideas -> 4
     - Hedge funds hope to uncover signals in hard-to-find, expensive and difficult to work with data.

** Process of Cross-sectional Strategies
   [[../resources/MOOC/Trading/cross_sectional.png]]


** Alpha Research Flow
   1. Observation: Find a pattern that seems to be recurring in the market over time.
   1. Turn the observation into Alpha(an expression), both mathematically and programmatically.
   1. (Alpha Combination: To combine several Alphas into an overall Alpha).
      - Important step in modern markets
      - Try to combine *different* inputs: e.g. Momentum alpha + Fundamental alpha
   1. Use historical data to verify it.
   1. Define strategy in more detailed manner, then run full backtesting exercises.


   Videos: [[https://youtu.be/cnJK8c2zfq4][Part1]] [[https://youtu.be/v3w4JZKQixc][Part2]] [[https://youtu.be/vSxnkduTWWY][Part3]]

** Momentum Strategy Example
   1. Choose a stock universe (attention: avoid *Survivorship Bias*)
   1. Re-sample prices if needed, then compute log returns.
   1. Rank by returns, select top-n/bottom-n(cross-sectional analysis)
   1. Compute long and short portfolio returns
   1. Combine portfolio returns

*** Statistical Analysis
    - Sample Monthly Mean Return: $\bar{x}$
    - t-statistic: $t=\frac{{\bar{x}-\mu_0}}{SE}=\frac{\bar{x}}{SE}$ (if the true mean month return $\mu_0$ is 0)
    - $H_0$: $\bar{x}=0$
    - $H_A$: $\bar{x}>0$
    - If *P-Value* $\le\alpha$ level, then reject $H_0$.

* Risks
  - Systematic Risks: Inherent to entire market
    - inflation
    - recession
    - interest rates
    - GDP
  - Sector-specific Risks
    - regulation
    - legislation
    - materials costs
  - Idiosyncratic Risks(Specific Risks)
    - labor strike
    - managerial change

* Data Processing
** Outliers
   Sources of outliers:
   - Fat Finger Errors
   - Data Errors: missing value, 0s, duplicate values...(could check if volume was 0)
   - Earnings, mergers and other announcements

*** Spotting Outliers in Raw Data
    - Screen the data
    - Rule-based searching and filtering methods. Examples:
      - percent change thresholds (but will yield many false positives)
      - can use volume information to improve the accuracy of the filter

*** Handling Outliers in Raw Data
    - *Cross check with another data source*
    - Minimize false positives
    - Decide how to deal with data values are missing
    - May keep the missing data

*** Spotting Outliers in Signal Returns
    - Look at the return distribution (skeptical when it's too good)
    - Compare return distribution to the normal distribution using *QQ Plots*
      - A good quant should try to understand the cause of outliers and returns.
      - Check the dates and stocks that causes the difference.

*** Handling Outliers in Signal Returns
    - Case1: Data error from venders
      - fix it by replacing with correct data from other venders
      - try to determine if the result will be greatly affected if the data is replaced by any reasonable value.
    - Case2: Due to legit market events
      - exclude small market cap assets (they're hard to predict)
    - Case3: Earnings, announcements
      - check if you can pause before these events
      - try to avoid losing money when you can't pause before the event

*** Ways to Reduce Effect of Outliers
    - Moving Window: But signals may be generated with a slight delay depending on the window size.
    - Use average prices of many stocks or even entire sector or index.
    - (Optional) May incorporate Bayesian methods or machine learning into outlier detection.

*** Filtering Decision Example
    Stock prices are volatile during market crashes. Two ways to handle:
    - Including the data during these periods
      - the results will be highly skewed.
      - the signals won't perform optimally on normal trading days.
    - Not including these data
      - When the event happens, the signal may perform really poorly.
      - To establish *stop loss levels* thresholds to prevent further losses.

** Testing for Normality
*** Why to Check If the Data is Normal?
    When we use statistical models such as regression. We use hypotheses tests to check if we can trust the model parameters of the model.
    These tests assume that our data is normally distributed.
    If our data is not normally distributed, these tests tend to tell us the model is valid when in fact it is not.

*** Box Plot
   - Use *Boxplot* to check for *symmetry*.
   [[../resources/MOOC/Trading/boxplot_of_normal_distribution.png]]

*** QQ Plot
    Quantile-Quantile Plot. Common quantiles are:
    - Quartiles: 4 groups
    - Deciles: 10 groups
    - Percentiles: 100 groups
    #+begin_src python
      import matplotlib.pyplot as plt
      from scipy.stats import gamma
      data = gamma.rvs(a=5, size=10000)
      stats.probplot(data, dist="norm", plot=plt)
      plt.show()
    #+end_src
   [[../resources/MOOC/Trading/qq_plot.png]]

*** Single Number Testing (cutoff point)
    - Shapiro-Wilk Test ~stats.shapiro~: $H_0$ - data is normal distributed
    - D'Agostino-Pearson Test: $H_0$ - data is normal distributed
    - Kolmogorov-Smirnov Test: $H_0$ - given two distribution, they are the same.
      #+begin_src python
	from scipy import stats
	sample = stats.lognorm.rvs(s=0.5, loc=0.0, scale=1.0, size=1000)
	normal_args = (sample.mean(), sample.std())
	result = stats.kstest(sample, "norm", normal_args)
	assert result.pvalue < 0.05
      #+end_src

** Regression
   To use one or more *independent* variables to predict a *dependent* variable. The regression is
   used to see how two assets move in relation to each other, e.g. Statistical Arbitrage.

* Terms
- Stock :: An asset that represents ownership in a company. A claim on part of a corportation's assets and earnings. There are two main types, common and preferred.
- Share :: A single share represents partial ownership of a company relative to the total number of shares in existence.
- Common Stock :: One main type of stock; entitles the owner to receive dividends and to vote at shareholder meetings.
- Preferred Stock :: The other main type of stock; generally does not entail voting rights, but entitles the owner to a higher claim on the assets and earnings of a company.
- Dividend :: A partial distribution of a company's profits to shareholders.
- Capital Gains :: Profits that result from the sale of an asset at a price higher than the purchase price.
- Security :: A tradable financial asset.
- Debt Security :: Money that is owed and must be repaid, like government or corporate bonds, or certificates of deposit. Also called fixed-income securities.
- Derivative Security :: A financial instrument whereby its value is derived from other assets.
- Equity :: The value of an owned asset minus the amount of all debts on that asset.
- Equity Security :: A security that represents fractional ownership in an entity, such as stock.
- Option Contract :: A contract which gives the buyer the right, but not the obligation, to buy or sell an underlying asset at a specified price on or by a specified date
- Futures Contract :: A contract that obligates the buyer to buy or the seller to sell an asset at a predetermined price at a specified time in the future
- Total Market Capitalization :: The dollar value of a company's outstanding shares.
- Inflection Point :: 拐点
- Cross-sectional Analysis :: Cross-sectional analysis looks at data collected at a single point in time, rather than over a period of time. OPP Time-series Analysis
- Data-snooping(P-hacking) :: The misuse of data analysis to find patterns in data by performing many statistical tests on the data and only reporting those that come back with significant results.
- Backtesting :: The process of rigorously simulating the entire flow in an automated fashion using historical data.
- Alpha :: An expression that outputs a vector of values which are proportional to the size of the position you will take on each asset.
  - The procedure that produces the ranks. The ranks themselves make up the *Alpha Vector*.
- Volume :: Number of shares traded.
- Turnover :: Volume Traded $\times$ Price Per Share
- Contrarian Strategies :: seek to identify sudden price movements and trade against such movements.(minute level data, risky)
- Lookahead Bias :: Incorporating the information from the future.(this misuse often make your results look better)
- Signal to Noise Ratio :: The signal is the meaningful part of input data. The noise is the random part of input data. The ratio is low for finance, the output models tend to *overfit* the data.
- Quartiles :: Quartiles are the three dividing lines that divide the data into four groups.

* Insights
** Why Invest in Complex Black-box Models?
   - risk the black box nature of the model in order to get access to *new* or *different* forecasts
     - pure AI-based strategies with exceptional performance
     - high Sharpe ratio high frequency algorithms

* Quant Workflow
  1. An initial hypothesis: an idea for a way to profit from trading.
     - How? The more you know about the markets, the more likely you are able to come up with a potentially profitable idea.

  1. Preliminary research and testing: in a fairly basic way, quickly test, determine:
     - *Signal* or *Alpha*
     - What assets to buy/sell at what time
  1. Detailed research and testing, and *backtesting*, to determine:
     - How to spend money
     - How to make trades
     - What conditions to exit positions
     - Risk constraints

* Stars
  - Lesson 5
    - [[https://youtu.be/jMT3VbUGiZI][9. Gaps in Market Data]]
  - Lesson 6
    - [[https://youtu.be/XaMaVFUIc_I][5. Missing Values]]
    - [[https://youtu.be/DFwu2ysGY8c][13. Alternative Data]]
    - [[https://youtu.be/g7zJV-Ontbo][14. Interview: Satellite Data]]
  - Lesson 7
    - [[https://youtu.be/62fZN1QnGjc][3. Log Returns]]
    - 5. Distributions of Returns and Prices [[https://youtu.be/cGoXGiO1DYk][Video]]
  - Lesson 8
    - [[https://youtu.be/O7c6bPXBUsU][1. Designing a Trading Strategy]]
    - [[https://youtu.be/TCOFgM-hxkQ][4. Long and Short Positions]]
    - [[https://youtu.be/rrCHC20FkIc][6. Trading Strategy]]
  - Project1 Trading with Momentum
    - [[https://youtu.be/8Hna_hR_N7c][4. Insights from a Quant]]
  - Lesson 12
    - [[https://youtu.be/Sa1MJegyYf][6. Testing for Normality]]
