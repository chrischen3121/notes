<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<!-- 2019-04-03 Wed 10:24 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python Cookbook</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="chrischen" />
<meta name="keywords" content="python, cookbook" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../styles/demo/css/demo.css"/>
<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Python Cookbook</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org99420de">1. Data Structures and Algorithms</a></li>
<li><a href="#orge170255">2. String Manipulation</a></li>
<li><a href="#orgf159f9b">3. Numbers</a></li>
<li><a href="#org7ac091c">4. Datetime</a></li>
<li><a href="#orge7734b1">5. Iterator</a></li>
<li><a href="#org81656d4">6. I/O</a></li>
</ul>
</div>
</div>
<div id="outline-container-org99420de" class="outline-2">
<h2 id="org99420de"><span class="section-number-2">1</span> Data Structures and Algorithms</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgaeef728" class="outline-3">
<h3 id="orgaeef728"><span class="section-number-3">1.1</span> Unpacking from Iterables</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-python">x, *<span style="color: #715ab1;">middle</span>, <span style="color: #715ab1;">y</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span>, <span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">3</span>, <span style="color: #4e3163;">4</span>, <span style="color: #4e3163;">5</span><span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">middle can be replaced by placeholder '_'</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">x =&gt; 1</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">y =&gt; 5</span>

<span style="color: #715ab1;">data</span> = <span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'ACME'</span>, <span style="color: #4e3163;">50</span>, <span style="color: #4e3163;">91</span>.<span style="color: #4e3163;">1</span>, <span style="color: #6c3163;">(</span><span style="color: #4e3163;">2012</span>, <span style="color: #4e3163;">12</span>, <span style="color: #4e3163;">21</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span>
name, shares, price, <span style="color: #3a81c3;">(</span>year, mon, day<span style="color: #3a81c3;">)</span> = data
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbacaa7d" class="outline-3">
<h3 id="orgbacaa7d"><span class="section-number-3">1.2</span> Keeping the Last N Items</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> deque
<span style="color: #715ab1;">d</span>=deque<span style="color: #3a81c3;">(</span>maxlen=N<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f0f1b7" class="outline-3">
<h3 id="org8f0f1b7"><span class="section-number-3">1.3</span> Finding the Largest N Items</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> heapq
heapq.nlargest<span style="color: #3a81c3;">(</span>N, items<span style="color: #3a81c3;">)</span>
heapq.nsmallest<span style="color: #3a81c3;">(</span>N, items<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">heapq.nlargest(N, data, key=lambda function)</span>
</pre>
</div>
<p>
Underneath the covers, they work by first converting the data into a list
where items are ordered as a heap.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">nums</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span>, <span style="color: #4e3163;">8</span>, <span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">23</span>, <span style="color: #4e3163;">7</span>, -<span style="color: #4e3163;">4</span>, <span style="color: #4e3163;">18</span>, <span style="color: #4e3163;">23</span>, <span style="color: #4e3163;">42</span>, <span style="color: #4e3163;">37</span>, <span style="color: #4e3163;">2</span><span style="color: #3a81c3;">]</span>
heapq.heapify<span style="color: #3a81c3;">(</span>nums<span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">inplace function</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">nums =&gt; [-4, 2, 1, 23, 7, 2, 18, 23, 42, 37, 8] heap[0] is the smallest</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org933915d" class="outline-3">
<h3 id="org933915d"><span class="section-number-3">1.4</span> PriorityQueue Implemention</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> heapq

<span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">PriorityQueue</span>:
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">__init__</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span><span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">self</span>._queue = <span style="color: #3a81c3;">[]</span>
        <span style="color: #3a81c3; font-weight: bold;">self</span>._index = <span style="color: #4e3163;">0</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">use index to properly order items with the same priority level</span>

    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">push</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>, item, priority<span style="color: #3a81c3;">)</span>:
        heapq.heappush<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>._queue, <span style="color: #6c3163;">(</span>-priority, <span style="color: #3a81c3; font-weight: bold;">self</span>._index, item<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3; font-weight: bold;">self</span>._index += <span style="color: #4e3163;">1</span>

    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">pop</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span><span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">return</span> heapq.heappop<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>._queue<span style="color: #3a81c3;">)[</span>-<span style="color: #4e3163;">1</span><span style="color: #3a81c3;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2225a4" class="outline-3">
<h3 id="orgf2225a4"><span class="section-number-3">1.5</span> defaultdict</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> defaultdict
<span style="color: #715ab1;">d</span> = defaultdict<span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">list</span><span style="color: #3a81c3;">)</span>
d<span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'a'</span><span style="color: #3a81c3;">]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; []</span>
</pre>
</div>
<p>
<b>defaultdict</b> will automatically create dictionary entries for keys accessed later on, alternative:
</p>
<div class="org-src-container">
<pre class="src src-python">d.setdefault<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'a'</span>, <span style="color: #6c3163;">[]</span><span style="color: #3a81c3;">)</span>.append<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org04c8730" class="outline-4">
<h4 id="org04c8730"><span class="section-number-4">1.5.1</span> alternative</h4>
<div class="outline-text-4" id="text-1-5-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">d</span> = <span style="color: #3a81c3;">{}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">A regular dictionary</span>
d.setdefault<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'a'</span>, <span style="color: #6c3163;">[]</span><span style="color: #3a81c3;">)</span>.append<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org740d4dc" class="outline-3">
<h3 id="org740d4dc"><span class="section-number-3">1.6</span> OrderedDict</h3>
<div class="outline-text-3" id="text-1-6">
<p>
An OrderedDict internally maintains a doubly linked list that orders the keys according to insertion order.
</p>
</div>
</div>

<div id="outline-container-org3996008" class="outline-3">
<h3 id="org3996008"><span class="section-number-3">1.7</span> sortedcontainers</h3>
<div class="outline-text-3" id="text-1-7">
<p>
SortedList, SortedDict, SortedSet
</p>
</div>
</div>

<div id="outline-container-orgfe9530a" class="outline-3">
<h3 id="orgfe9530a"><span class="section-number-3">1.8</span> Calculating with Dictionaries</h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">prices</span> = <span style="color: #3a81c3;">{</span>
    <span style="color: #2d9574;">'ACME'</span>: <span style="color: #4e3163;">45</span>.<span style="color: #4e3163;">23</span>,
    <span style="color: #2d9574;">'AAPL'</span>: <span style="color: #4e3163;">612</span>.<span style="color: #4e3163;">78</span>,
    <span style="color: #2d9574;">'IBM'</span>: <span style="color: #4e3163;">205</span>.<span style="color: #4e3163;">55</span>,
    <span style="color: #2d9574;">'HPQ'</span>: <span style="color: #4e3163;">37</span>.<span style="color: #4e3163;">20</span>,
    <span style="color: #2d9574;">'FB'</span>: <span style="color: #4e3163;">10</span>.<span style="color: #4e3163;">75</span>
<span style="color: #3a81c3;">}</span>
<span style="color: #715ab1;">min_price</span> = <span style="color: #3a81c3;">min</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">zip</span><span style="color: #6c3163;">(</span>prices.values<span style="color: #2d9574;">()</span>, prices.keys<span style="color: #2d9574;">()</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">zip to ((value, key)) generator</span>

<span style="color: #3a81c3;">min</span><span style="color: #3a81c3;">(</span>prices, key=<span style="color: #3a81c3; font-weight: bold;">lambda</span> k: prices<span style="color: #6c3163;">[</span>k<span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Returns 'FB'</span>
<span style="color: #715ab1;">min_value</span> = prices<span style="color: #3a81c3;">[</span><span style="color: #3a81c3;">min</span><span style="color: #6c3163;">(</span>prices, key=<span style="color: #3a81c3; font-weight: bold;">lambda</span> k: prices<span style="color: #2d9574;">[</span>k<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org90989db" class="outline-3">
<h3 id="org90989db"><span class="section-number-3">1.9</span> keys-view</h3>
<div class="outline-text-3" id="text-1-9">
<div class="org-src-container">
<pre class="src src-python">a.keys<span style="color: #3a81c3;">()</span> &amp; b.keys<span style="color: #3a81c3;">()</span>
a.keys<span style="color: #3a81c3;">()</span> - <span style="color: #3a81c3;">{</span><span style="color: #2d9574;">'z'</span>, <span style="color: #2d9574;">'w'</span><span style="color: #3a81c3;">}</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">{'z', 'w'} is a set</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9218d41" class="outline-3">
<h3 id="org9218d41"><span class="section-number-3">1.10</span> Naming a Slice</h3>
<div class="outline-text-3" id="text-1-10">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">a</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span>,<span style="color: #4e3163;">2</span>,<span style="color: #4e3163;">3</span>,<span style="color: #4e3163;">4</span>,<span style="color: #4e3163;">5</span><span style="color: #3a81c3;">]</span>
<span style="color: #715ab1;">b</span> = <span style="color: #3a81c3;">slice</span><span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1</span>,<span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span>

a<span style="color: #3a81c3;">[</span>b<span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; [2] slower than a[1]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a9cb43" class="outline-3">
<h3 id="org1a9cb43"><span class="section-number-3">1.11</span> Counting</h3>
<div class="outline-text-3" id="text-1-11">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> Counter
<span style="color: #715ab1;">word_counts1</span> = Counter<span style="color: #3a81c3;">(</span>words1<span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">word_counts2</span> = Counter<span style="color: #3a81c3;">(</span>words2<span style="color: #3a81c3;">)</span>
word_counts1 + word_counts2
</pre>
</div>
</div>
</div>

<div id="outline-container-org174c404" class="outline-3">
<h3 id="org174c404"><span class="section-number-3">1.12</span> Sorting a List of Dictionaries</h3>
<div class="outline-text-3" id="text-1-12">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> operator <span style="color: #3a81c3; font-weight: bold;">import</span> itemgetter
<span style="color: #715ab1;">rows_by_fname</span> = <span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>rows, key=itemgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'fname'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">rows_by_lfname</span> = <span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>rows, key=itemgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'lname'</span>,<span style="color: #2d9574;">'fname'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #715ab1;">g</span> = itemgetter<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">5</span>, <span style="color: #4e3163;">3</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">the call g(r) returns (r[2], r[5], r[3])</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1dad8c9" class="outline-3">
<h3 id="org1dad8c9"><span class="section-number-3">1.13</span> Sorting Objects Without Native Comparison</h3>
<div class="outline-text-3" id="text-1-13">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>users, key=<span style="color: #3a81c3; font-weight: bold;">lambda</span> u: u.user_id<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">from</span> operator <span style="color: #3a81c3; font-weight: bold;">import</span> attrgetter
<span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>users, key=attrgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'user_id'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">by_name</span> = <span style="color: #3a81c3;">sorted</span><span style="color: #3a81c3;">(</span>users, key=attrgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'last_name'</span>, <span style="color: #2d9574;">'first_name'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org358d768" class="outline-3">
<h3 id="org358d768"><span class="section-number-3">1.14</span> groupby</h3>
<div class="outline-text-3" id="text-1-14">
<p>
Since <code>groupby()</code> only examines consecutive items, should sort the groupby key first.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> itertools <span style="color: #3a81c3; font-weight: bold;">import</span> groupby
rows.sort<span style="color: #3a81c3;">(</span>key=itemgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'date'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> date, items <span style="color: #3a81c3; font-weight: bold;">in</span> groupby<span style="color: #3a81c3;">(</span>rows, key=itemgetter<span style="color: #6c3163;">(</span><span style="color: #2d9574;">'date'</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">pass</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">alternative if memory is no concern, and faster than sort+groupby</span>
<span style="color: #715ab1;">rows_by_date</span> = defaultdict<span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">list</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> row <span style="color: #3a81c3; font-weight: bold;">in</span> rows:
    rows_by_date<span style="color: #3a81c3;">[</span>row<span style="color: #6c3163;">[</span><span style="color: #2d9574;">'date'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">]</span>.append<span style="color: #3a81c3;">(</span>row<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org93f78cf" class="outline-3">
<h3 id="org93f78cf"><span class="section-number-3">1.15</span> itertools.compress</h3>
<div class="outline-text-3" id="text-1-15">
<p>
Like boolean index in pandas. Takes an iterable and an accompanying Boolean selector sequence as input.
<code>list(compress(data, mask))</code>
</p>
</div>
</div>

<div id="outline-container-org90b4a10" class="outline-3">
<h3 id="org90b4a10"><span class="section-number-3">1.16</span> namedtuple &amp; namedlist</h3>
<div class="outline-text-3" id="text-1-16">
<p>
optional or missing fields
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">Stock</span> = namedtuple<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'Stock'</span>, <span style="color: #6c3163;">[</span><span style="color: #2d9574;">'name'</span>, <span style="color: #2d9574;">'shares'</span>, <span style="color: #2d9574;">'price'</span>, <span style="color: #2d9574;">'date'</span>, <span style="color: #2d9574;">'time'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">Stock.__new__.__defaults__</span> = <span style="color: #3a81c3;">(</span><span style="color: #2d9574;">''</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">None</span>, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">or</span>
<span style="color: #715ab1;">stock_prototype</span> = Stock<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">''</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>.<span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">None</span>, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">dict_to_stock</span><span style="color: #3a81c3;">(</span>s<span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">return</span> stock_prototype._replace<span style="color: #3a81c3;">(</span>**s<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
<div id="outline-container-org5490561" class="outline-4">
<h4 id="org5490561"><span class="section-number-4">1.16.1</span> useful method</h4>
<div class="outline-text-4" id="text-1-16-1">
<ul class="org-ul">
<li><code>_make</code>: Make a new Stock object from a sequence or iterable</li>
<li><code>_replace</code></li>
<li><code>_fields</code></li>
<li><code>_asdict</code></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org92539a4" class="outline-3">
<h3 id="org92539a4"><span class="section-number-3">1.17</span> sum, min,&#x2026;</h3>
<div class="outline-text-3" id="text-1-17">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">s</span> = <span style="color: #3a81c3;">sum</span><span style="color: #3a81c3;">(</span><span style="color: #6c3163;">(</span>x * x <span style="color: #3a81c3; font-weight: bold;">for</span> x <span style="color: #3a81c3; font-weight: bold;">in</span> nums<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">s</span> = <span style="color: #3a81c3;">sum</span><span style="color: #3a81c3;">(</span>x * x <span style="color: #3a81c3; font-weight: bold;">for</span> x <span style="color: #3a81c3; font-weight: bold;">in</span> nums<span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">same as above</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Original: Returns 20</span>
<span style="color: #715ab1;">min_shares</span> = <span style="color: #3a81c3;">min</span><span style="color: #3a81c3;">(</span>s<span style="color: #6c3163;">[</span><span style="color: #2d9574;">'shares'</span><span style="color: #6c3163;">]</span> <span style="color: #3a81c3; font-weight: bold;">for</span> s <span style="color: #3a81c3; font-weight: bold;">in</span> portfolio<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Alternative: Returns {'name': 'AOL', 'shares': 20}</span>
<span style="color: #715ab1;">min_shares</span> = <span style="color: #3a81c3;">min</span><span style="color: #3a81c3;">(</span>portfolio, key=<span style="color: #3a81c3; font-weight: bold;">lambda</span> s: s<span style="color: #6c3163;">[</span><span style="color: #2d9574;">'shares'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org991627b" class="outline-3">
<h3 id="org991627b"><span class="section-number-3">1.18</span> ChainMap</h3>
<div class="outline-text-3" id="text-1-18">
<p>
A ChainMap takes multiple mappings and makes them logically appear as one. If there are duplicate keys,
the values from the first mapping get used.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> ChainMap
<span style="color: #715ab1;">c</span> = ChainMap<span style="color: #3a81c3;">(</span>a,b<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">alternative</span>
<span style="color: #715ab1;">c</span> = b
c.update<span style="color: #3a81c3;">(</span>a<span style="color: #3a81c3;">)</span>
</pre>
</div>
<ul class="org-ul">
<li>but ChainMap keep the reference of a&amp;b</li>
</ul>
</div>

<div id="outline-container-org7ed3ab6" class="outline-4">
<h4 id="org7ed3ab6"><span class="section-number-4">1.18.1</span> store scoped values</h4>
<div class="outline-text-4" id="text-1-18-1">
<p>
A ChainMap is particularly useful when working with scoped values such as variables in
a programming language (i.e., globals, locals, etc.)
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">values</span> = ChainMap<span style="color: #3a81c3;">()</span>
<span style="color: #715ab1;">values</span><span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">]</span> = <span style="color: #4e3163;">1</span>
<span style="color: #715ab1;">values</span> = values.new_child<span style="color: #3a81c3;">()</span>
<span style="color: #715ab1;">values</span><span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">]</span> = <span style="color: #4e3163;">2</span>
values<span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 2</span>
<span style="color: #715ab1;">values</span> = values.parents
values<span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orge170255" class="outline-2">
<h2 id="orge170255"><span class="section-number-2">2</span> String Manipulation</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org8555d85" class="outline-3">
<h3 id="org8555d85"><span class="section-number-3">2.1</span> modules</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li><b>fnmatch</b>: Filename matching with shell patterns.</li>
<li><b>glob</b>: Filename globbing utility.</li>
</ul>
</div>
</div>

<div id="outline-container-org60d5cc4" class="outline-3">
<h3 id="org60d5cc4"><span class="section-number-3">2.2</span> re</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org52e2fc4" class="outline-4">
<h4 id="org52e2fc4"><span class="section-number-4">2.2.1</span> find</h4>
<div class="outline-text-4" id="text-2-2-1">
<ul class="org-ul">
<li><code>match()</code></li>
<li><code>findall()</code></li>
<li><code>finditer()</code></li>
<li><code>scaner()</code></li>
</ul>
</div>
</div>

<div id="outline-container-org86631b2" class="outline-4">
<h4 id="org86631b2"><span class="section-number-4">2.2.2</span> replace</h4>
<div class="outline-text-4" id="text-2-2-2">
<ul class="org-ul">
<li><code>sub</code></li>
</ul>
</div>
</div>

<div id="outline-container-org6ac5644" class="outline-4">
<h4 id="org6ac5644"><span class="section-number-4">2.2.3</span> regex</h4>
<div class="outline-text-4" id="text-2-2-3">
<ul class="org-ul">
<li>named capture group: <code>r'?P&lt;TOKENNAME&gt;[a-zA-Z]+'</code></li>
<li>noncapture</li>
</ul>
</div>
</div>

<div id="outline-container-orgf1eaa08" class="outline-4">
<h4 id="orgf1eaa08"><span class="section-number-4">2.2.4</span> tokenize</h4>
<div class="outline-text-4" id="text-2-2-4">
</div>
<ul class="org-ul">
<li><a id="orgf29afea"></a>Problem<br />
<div class="outline-text-5" id="text-orgf29afea">
<p>
You have a string that you want to parse left to right into a stream of tokens.
</p>
</div>
</li>
<li><a id="org8ee6b9f"></a>Usage<br />
<div class="outline-text-5" id="text-org8ee6b9f">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> namedtuple
<span style="color: #715ab1;">Token</span> = namedtuple<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'Token'</span>, <span style="color: #6c3163;">[</span><span style="color: #2d9574;">'type'</span>, <span style="color: #2d9574;">'value'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">generate_tokens</span><span style="color: #3a81c3;">(</span>pat, text<span style="color: #3a81c3;">)</span>:
    <span style="color: #715ab1;">scanner</span> = pat.scanner<span style="color: #3a81c3;">(</span>text<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">for</span> m <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">iter</span><span style="color: #3a81c3;">(</span>scanner.match, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">yield</span> Token<span style="color: #3a81c3;">(</span>m.lastgroup, m.group<span style="color: #6c3163;">()</span><span style="color: #3a81c3;">)</span>


<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Example use</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> tok <span style="color: #3a81c3; font-weight: bold;">in</span> generate_tokens<span style="color: #3a81c3;">(</span>master_pat, <span style="color: #2d9574;">'foo = 42'</span><span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>tok<span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Produces output</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Token(type='NAME', value='foo')</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Token(type='WS', value=' ')</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Token(type='EQ', value='=')</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Token(type='WS', value=' ')</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Token(type='NUM', value='42')</span>
</pre>
</div>
<p>
<code>scanner()</code> method of pattern objects. This method creates a scanner object in which repeated calls to match() step through the
supplied text one match at a time
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgf2b7967" class="outline-4">
<h4 id="orgf2b7967"><span class="section-number-4">2.2.5</span> syntax parser</h4>
<div class="outline-text-4" id="text-2-2-5">
<ul class="org-ul">
<li>PyParsing</li>
<li>PLY</li>
<li>Recipe: 2.19</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org5ae78cd" class="outline-3">
<h3 id="org5ae78cd"><span class="section-number-3">2.3</span> format</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org5d1802b" class="outline-4">
<h4 id="org5d1802b"><span class="section-number-4">2.3.1</span> align</h4>
<div class="outline-text-4" id="text-2-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'right'</span>, <span style="color: #2d9574;">'&gt;20'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">'               right'</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'right'</span>, <span style="color: #2d9574;">'=&gt;20'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">'===============right'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga89b4a8" class="outline-4">
<h4 id="orga89b4a8"><span class="section-number-4">2.3.2</span> safesub</h4>
<div class="outline-text-4" id="text-2-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">safesub</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">dict</span><span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">__missing__</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">self</span>, key<span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">return</span> <span style="color: #2d9574;">'{'</span> + key + <span style="color: #2d9574;">'}'</span>

<span style="color: #715ab1;">name</span> = <span style="color: #2d9574;">'ABC'</span>
<span style="color: #715ab1;">n</span> = <span style="color: #4e3163;">5</span>
<span style="color: #715ab1;">s</span> = <span style="color: #2d9574;">'{name} has {n} messages.'</span>
s.format_map<span style="color: #3a81c3;">(</span>safesub<span style="color: #6c3163;">(</span><span style="color: #3a81c3;">vars</span><span style="color: #2d9574;">()</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">'ABC has 5 messages.'</span>
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org3f2f9ce"></a>frame hack<br />
<div class="outline-text-5" id="text-org3f2f9ce">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">sub</span><span style="color: #3a81c3;">(</span>text<span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">return</span> text.format_map<span style="color: #3a81c3;">(</span>safesub<span style="color: #6c3163;">(</span>sys._getframe<span style="color: #2d9574;">(</span><span style="color: #4e3163;">1</span><span style="color: #2d9574;">)</span>.f_locals<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgc2ea36d" class="outline-4">
<h4 id="orgc2ea36d"><span class="section-number-4">2.3.3</span> textwrap</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
The textwrap module is a straightforward way to clean up text for printing.
<code>textwrap.fill()</code> reformat text for output.
</p>
</div>
</div>
</div>

<div id="outline-container-org30ce568" class="outline-3">
<h3 id="org30ce568"><span class="section-number-3">2.4</span> join</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li><code>'abc' + ',' + 'def'</code></li>
<li><code>'abc' ',' 'def'</code></li>
<li><code>','.join(('abc', 'def'))</code></li>
<li><code>'{},{}'.format('abc', 'def')</code></li>
<li>print('abc', 'def', sep=',')</li>
</ul>
</div>
</div>

<div id="outline-container-org4b2ab47" class="outline-3">
<h3 id="org4b2ab47"><span class="section-number-3">2.5</span> Combining I/O Write Operation</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">combine</span><span style="color: #3a81c3;">(</span>source, maxsize<span style="color: #3a81c3;">)</span>:
    <span style="color: #715ab1;">parts</span> = <span style="color: #3a81c3;">[]</span>
    <span style="color: #715ab1;">size</span> = <span style="color: #4e3163;">0</span>
    <span style="color: #3a81c3; font-weight: bold;">for</span> part <span style="color: #3a81c3; font-weight: bold;">in</span> source:
        parts.append<span style="color: #3a81c3;">(</span>part<span style="color: #3a81c3;">)</span>
        <span style="color: #715ab1;">size</span> += <span style="color: #3a81c3;">len</span><span style="color: #3a81c3;">(</span>part<span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3; font-weight: bold;">if</span> size &gt; maxsize:
            <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #2d9574;">''</span>.join<span style="color: #3a81c3;">(</span>parts<span style="color: #3a81c3;">)</span>
            <span style="color: #715ab1;">parts</span> = <span style="color: #3a81c3;">[]</span>
            <span style="color: #715ab1;">size</span> = <span style="color: #4e3163;">0</span>
    <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #2d9574;">''</span>.join<span style="color: #3a81c3;">(</span>parts<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">for</span> part <span style="color: #3a81c3; font-weight: bold;">in</span> combine<span style="color: #3a81c3;">(</span>sample<span style="color: #6c3163;">()</span>, <span style="color: #4e3163;">32768</span><span style="color: #3a81c3;">)</span>:
    f.write<span style="color: #3a81c3;">(</span>part<span style="color: #3a81c3;">)</span>
</pre>
</div>
<ul class="org-ul">
<li>Example: write to socket send buffer</li>
</ul>
</div>
</div>

<div id="outline-container-org20fd93d" class="outline-3">
<h3 id="org20fd93d"><span class="section-number-3">2.6</span> escape</h3>
<div class="outline-text-3" id="text-2-6">
<ul class="org-ul">
<li><code>html.escape</code></li>
<li><code>xml.escape</code></li>
</ul>
</div>
</div>

<div id="outline-container-org5b242ae" class="outline-3">
<h3 id="org5b242ae"><span class="section-number-3">2.7</span> Tokenizing Text</h3>
<div class="outline-text-3" id="text-2-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> re
<span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> namedtuple

<span style="color: #715ab1;">NAME</span> = r<span style="color: #2d9574;">'(?P&lt;NAME&gt;[a-zA-Z_][a-zA-Z_0-9]*)'</span>
<span style="color: #715ab1;">NUM</span> = r<span style="color: #2d9574;">'(?P&lt;NUM&gt;\d+)'</span>
<span style="color: #715ab1;">PLUS</span> = r<span style="color: #2d9574;">'(?P&lt;PLUS&gt;\+)'</span>
<span style="color: #715ab1;">TIMES</span> = r<span style="color: #2d9574;">'(?P&lt;TIMES&gt;\*)'</span>
<span style="color: #715ab1;">EQ</span> = r<span style="color: #2d9574;">'(?P&lt;EQ&gt;=)'</span>
<span style="color: #715ab1;">WS</span> = r<span style="color: #2d9574;">'(?P&lt;WS&gt;\s+)'</span>

<span style="color: #715ab1;">master_pat</span> = re.<span style="color: #3a81c3;">compile</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'|'</span>.join<span style="color: #6c3163;">(</span><span style="color: #2d9574;">[</span>NAME, NUM, PLUS, TIMES, EQ, WS<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #715ab1;">Token</span> = namedtuple<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'Token'</span>, <span style="color: #6c3163;">[</span><span style="color: #2d9574;">'type'</span>, <span style="color: #2d9574;">'value'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">generate_tokens</span><span style="color: #3a81c3;">(</span>pat, text<span style="color: #3a81c3;">)</span>:
    <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">scanner method creates a scanner object in which repeated calls to match()</span>
    <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">step through the supplied text one match at a time</span>
    <span style="color: #715ab1;">scanner</span> = pat.scanner<span style="color: #3a81c3;">(</span>text<span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">for</span> m <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">iter</span><span style="color: #3a81c3;">(</span>scanner.match, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">)</span>:
        <span style="color: #3a81c3; font-weight: bold;">yield</span> Token<span style="color: #3a81c3;">(</span>m.lastgroup, m.group<span style="color: #6c3163;">()</span><span style="color: #3a81c3;">)</span>


<span style="color: #715ab1;">tokens</span> = <span style="color: #3a81c3;">(</span>tok <span style="color: #3a81c3; font-weight: bold;">for</span> tok <span style="color: #3a81c3; font-weight: bold;">in</span> generate_tokens<span style="color: #6c3163;">(</span>master_pat, <span style="color: #2d9574;">'foo = 42'</span><span style="color: #6c3163;">)</span>
          <span style="color: #3a81c3; font-weight: bold;">if</span> tok.<span style="color: #3a81c3;">type</span> != <span style="color: #2d9574;">'WS'</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> tok <span style="color: #3a81c3; font-weight: bold;">in</span> tokens:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>tok<span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Produces output</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Token(type='NAME', value='foo')</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Token(type='EQ', value='=')</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Token(type='NUM', value='42')</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf159f9b" class="outline-2">
<h2 id="orgf159f9b"><span class="section-number-2">3</span> Numbers</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org76cf8dc" class="outline-3">
<h3 id="org76cf8dc"><span class="section-number-3">3.1</span> round</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3;">round</span><span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1</span>.<span style="color: #4e3163;">29</span>, <span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1.3</span>
<span style="color: #3a81c3;">round</span><span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1245</span>, -<span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1240</span>
<span style="color: #3a81c3;">round</span><span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1275</span>, -<span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1280</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd66f02" class="outline-3">
<h3 id="orgcd66f02"><span class="section-number-3">3.2</span> Decimal</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> decimal <span style="color: #3a81c3; font-weight: bold;">import</span> Decimal, localcontext
<span style="color: #715ab1;">a</span> = Decimal<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'6.32'</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">b</span> = Decimal<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'2.41'</span><span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">with</span> localcontext<span style="color: #3a81c3;">()</span> <span style="color: #3a81c3; font-weight: bold;">as</span> ctx:
    <span style="color: #715ab1;">ctx.prec</span> = <span style="color: #4e3163;">5</span>
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>a/b<span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">2.6224</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8665dd" class="outline-3">
<h3 id="orgf8665dd"><span class="section-number-3">3.3</span> Formatting</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">x</span> = <span style="color: #4e3163;">1234</span>.<span style="color: #4e3163;">56789</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span>x, <span style="color: #2d9574;">'0.2f'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; '1234.57'   # round</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span>x, <span style="color: #2d9574;">'&gt;10.1f'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; '    1234.6'</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span>x, <span style="color: #2d9574;">'0,.1f'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; '1,234.6</span>

<span style="color: #715ab1;">x</span> = <span style="color: #4e3163;">1234</span>
<span style="color: #3a81c3;">bin</span><span style="color: #3a81c3;">(</span>x<span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">others: oct, hex</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; '0b10011010010'</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span>x, <span style="color: #2d9574;">'b'</span><span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">others: o, x</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; '0011010010'</span>
<span style="color: #3a81c3;">int</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'10011010010'</span>, <span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1234</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org081135e" class="outline-3">
<h3 id="org081135e"><span class="section-number-3">3.4</span> Bin, Oct, Hex Int</h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">x</span> = -<span style="color: #4e3163;">1234</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span>x, <span style="color: #2d9574;">'b'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; '-10011010010'</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span>x, <span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; '-4d2'</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span><span style="color: #4e3163;">2</span>**<span style="color: #4e3163;">32</span> + x, <span style="color: #2d9574;">'b'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; '11111111111111111111101100101110'</span>
<span style="color: #3a81c3;">format</span><span style="color: #3a81c3;">(</span><span style="color: #4e3163;">2</span>**<span style="color: #4e3163;">32</span> + x, <span style="color: #2d9574;">'x'</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 'fffffb2e'</span>
<span style="color: #3a81c3;">int</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'4d2'</span>, <span style="color: #4e3163;">16</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1234</span>
<span style="color: #3a81c3;">int</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'10011010010'</span>, <span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 1234</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org311b5ac" class="outline-3">
<h3 id="org311b5ac"><span class="section-number-3">3.5</span> Bytes2Int</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">data</span> = b<span style="color: #2d9574;">'\x00\x124V\x00x\x90\xab\x00\xcd\xef\x01\x00#\x004'</span>
<span style="color: #715ab1;">x</span> = <span style="color: #3a81c3;">int</span>.from_bytes<span style="color: #3a81c3;">(</span>data, <span style="color: #2d9574;">'little'</span><span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">or 'big</span>

<span style="color: #715ab1;">x</span> = <span style="color: #4e3163;">94522842520747284487117727783387188</span>
x.to_bytes<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">16</span>, <span style="color: #2d9574;">'little'</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
<p>
useful in cryptography or networking domains
</p>
<ul class="org-ul">
<li><code>struct</code> module</li>
<li><code>int.bit_length()</code></li>
</ul>
</div>
</div>

<div id="outline-container-orgb556ba9" class="outline-3">
<h3 id="orgb556ba9"><span class="section-number-3">3.6</span> Complex Math</h3>
<div class="outline-text-3" id="text-3-6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">a</span> = <span style="color: #3a81c3;">complex</span><span style="color: #3a81c3;">(</span><span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">4</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">b</span> = <span style="color: #4e3163;">3</span> - <span style="color: #4e3163;">5j</span>
a.conjugate<span style="color: #3a81c3;">()</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (2-4j)</span>
<span style="color: #3a81c3;">abs</span><span style="color: #3a81c3;">(</span>a<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 4.47213595499958</span>
a * b
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (26+2j)</span>

<span style="color: #3a81c3; font-weight: bold;">import</span> cmath
cmath.sin<span style="color: #3a81c3;">(</span>a<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (24.83130584894638-11.356612711218174j)</span>

<span style="color: #3a81c3; font-weight: bold;">import</span> numpy <span style="color: #3a81c3; font-weight: bold;">as</span> np
<span style="color: #715ab1;">a</span> = np.array<span style="color: #3a81c3;">(</span><span style="color: #6c3163;">[</span><span style="color: #4e3163;">2</span> + <span style="color: #4e3163;">3j</span>, <span style="color: #4e3163;">4</span> + <span style="color: #4e3163;">5j</span>, <span style="color: #4e3163;">6</span> - <span style="color: #4e3163;">7j</span>, <span style="color: #4e3163;">8</span> + <span style="color: #4e3163;">9j</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
np.sin<span style="color: #3a81c3;">(</span>a<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfbe4c61" class="outline-3">
<h3 id="orgfbe4c61"><span class="section-number-3">3.7</span> random</h3>
<div class="outline-text-3" id="text-3-7">
<ul class="org-ul">
<li><code>random.choice</code></li>
<li><code>random.sample</code></li>
<li><code>random.shuffle</code></li>
<li><code>random.randint</code></li>
<li><code>random.random</code>: 0 to 1</li>
<li><code>random.getrandbits</code></li>
</ul>
</div>
<div id="outline-container-orgdd87e0f" class="outline-4">
<h4 id="orgdd87e0f"><span class="section-number-4">3.7.1</span> seed</h4>
<div class="outline-text-4" id="text-3-7-1">
<div class="org-src-container">
<pre class="src src-python">random.seed<span style="color: #3a81c3;">()</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Seed based on system time or os.urandom()</span>
random.seed<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">12345</span><span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Seed based on integer given</span>
random.seed<span style="color: #3a81c3;">(</span>b<span style="color: #2d9574;">'bytedata'</span><span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Seed based on byte data</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org614874f" class="outline-4">
<h4 id="org614874f"><span class="section-number-4">3.7.2</span> distribution</h4>
<div class="outline-text-4" id="text-3-7-2">
<ul class="org-ul">
<li><code>random.uniform</code></li>
<li><code>random.gauss</code></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org7b587dc" class="outline-3">
<h3 id="org7b587dc"><span class="section-number-3">3.8</span> math.f***</h3>
<div class="outline-text-3" id="text-3-8">
<ul class="org-ul">
<li><code>math.fsum</code></li>
<li><code>math.fmod</code></li>
<li><code>math.fabs</code></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org7ac091c" class="outline-2">
<h2 id="org7ac091c"><span class="section-number-2">4</span> Datetime</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org3672442" class="outline-3">
<h3 id="org3672442"><span class="section-number-3">4.1</span> Finding Last Friday</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> dateutil.relativedelta <span style="color: #3a81c3; font-weight: bold;">import</span> relativedelta
<span style="color: #3a81c3; font-weight: bold;">from</span> dateutil.rrule <span style="color: #3a81c3; font-weight: bold;">import</span> FR
<span style="color: #715ab1;">d</span> = datetime.now<span style="color: #3a81c3;">()</span>
<span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>d + relativedelta<span style="color: #6c3163;">(</span>weekday=FR<span style="color: #2d9574;">(</span>-<span style="color: #4e3163;">1</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf902fd5" class="outline-3">
<h3 id="orgf902fd5"><span class="section-number-3">4.2</span> Timezone</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> pytz
<span style="color: #715ab1;">d</span> = datetime.now<span style="color: #3a81c3;">()</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">no timezone info</span>
<span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>d<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 2018-12-21 17:14:01.258941</span>

<span style="color: #715ab1;">shanghai</span> = pytz.timezone<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'Asia/Shanghai'</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">loc_d</span> = shanghai.localize<span style="color: #3a81c3;">(</span>d<span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Localize the date for Shanghai</span>
<span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>loc_d<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 2018-12-21 17:14:01.258941+08:00</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Once the date has been localized, it can be converted to other time zones</span>
<span style="color: #715ab1;">utc_d</span> = loc_d.astimezone<span style="color: #3a81c3;">(</span>pytz.utc<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>utc_d<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; 2018-12-21 09:14:01.258941+00:00</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge7734b1" class="outline-2">
<h2 id="orge7734b1"><span class="section-number-2">5</span> Iterator</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org3da43ec" class="outline-3">
<h3 id="org3da43ec"><span class="section-number-3">5.1</span> Manually Consuming an Iterator</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">iterable</span> = <span style="color: #3a81c3;">iter</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3;">range</span><span style="color: #6c3163;">(</span><span style="color: #4e3163;">5</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Invokes range.__iter__()</span>
<span style="color: #3a81c3; font-weight: bold;">try</span>:
    <span style="color: #3a81c3; font-weight: bold;">while</span> <span style="color: #4e3163;">True</span>:
        <span style="color: #715ab1;">line</span> = <span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>iterable<span style="color: #3a81c3;">)</span>  <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Invokes iterable.__next__()</span>
        <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>line, end=<span style="color: #2d9574;">''</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">except</span> <span style="color: #ba2f59; font-weight: bold;">StopIteration</span>:
    <span style="color: #3a81c3; font-weight: bold;">pass</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">non exception version</span>
<span style="color: #3a81c3; font-weight: bold;">while</span> <span style="color: #4e3163;">True</span>:
    <span style="color: #715ab1;">line</span> = <span style="color: #3a81c3;">next</span><span style="color: #3a81c3;">(</span>iterable, <span style="color: #4e3163;">None</span><span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">if</span> line <span style="color: #3a81c3; font-weight: bold;">is</span> <span style="color: #4e3163;">None</span>:
        <span style="color: #3a81c3; font-weight: bold;">break</span>
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>line, end=<span style="color: #2d9574;">''</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
<ul class="org-ul">
<li>Pythons iterator protocol requires <code>__iter__()</code> to return a special iterator object that implements a <code>__next__()</code> method to carry out the actual iteration.</li>
</ul>
</div>
</div>
<div id="outline-container-org8ad5fd2" class="outline-3">
<h3 id="org8ad5fd2"><span class="section-number-3">5.2</span> Iterating Over Multi Sequences</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">a</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span>, <span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">3</span><span style="color: #3a81c3;">]</span>
<span style="color: #715ab1;">b</span> = <span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'w'</span>, <span style="color: #2d9574;">'x'</span>, <span style="color: #2d9574;">'y'</span>, <span style="color: #2d9574;">'z'</span><span style="color: #3a81c3;">]</span>

<span style="color: #3a81c3; font-weight: bold;">for</span> i <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">zip</span><span style="color: #3a81c3;">(</span>a, b<span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>i<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (1, 'w') (2, 'x') (3, 'y')</span>

<span style="color: #3a81c3; font-weight: bold;">from</span> itertools <span style="color: #3a81c3; font-weight: bold;">import</span> zip_longest
<span style="color: #3a81c3; font-weight: bold;">for</span> i <span style="color: #3a81c3; font-weight: bold;">in</span> zip_longest<span style="color: #3a81c3;">(</span>a, b<span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>i<span style="color: #3a81c3;">)</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">=&gt; (1, 'w') (2, 'x') (3, 'y') (None, 'z')</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org107b2b4" class="outline-3">
<h3 id="org107b2b4"><span class="section-number-3">5.3</span> <code>dropwhile</code></h3>
<div class="outline-text-3" id="text-5-3">
<p>
Drop all of the initial comment lines.
</p>
</div>
</div>

<div id="outline-container-orge81e029" class="outline-3">
<h3 id="orge81e029"><span class="section-number-3">5.4</span> Permutation &amp; Combination</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li><code>combinations</code>, <code>permutations</code>, <code>combinations_with_replacement</code></li>
</ul>
</div>
</div>

<div id="outline-container-org57a4ec6" class="outline-3">
<h3 id="org57a4ec6"><span class="section-number-3">5.5</span> <code>itertools.chain</code></h3>
<div class="outline-text-3" id="text-5-5">
<p>
Concatenate two iterables(copy-free)
</p>
</div>
</div>
<div id="outline-container-orgb13343a" class="outline-3">
<h3 id="orgb13343a"><span class="section-number-3">5.6</span> Data Processing Pipelines</h3>
</div>
<div id="outline-container-orgaafb603" class="outline-3">
<h3 id="orgaafb603"><span class="section-number-3">5.7</span> Flattening a Nested Sequence</h3>
<div class="outline-text-3" id="text-5-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> collections <span style="color: #3a81c3; font-weight: bold;">import</span> Iterable


<span style="color: #3a81c3; font-weight: bold;">def</span> <span style="color: #6c3163; font-weight: bold;">flatten</span><span style="color: #3a81c3;">(</span>items, ignore_types=<span style="color: #6c3163;">(</span><span style="color: #3a81c3;">str</span>, <span style="color: #3a81c3;">bytes</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">for</span> x <span style="color: #3a81c3; font-weight: bold;">in</span> items:
        <span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #3a81c3;">isinstance</span><span style="color: #3a81c3;">(</span>x, Iterable<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3; font-weight: bold;">and</span> <span style="color: #3a81c3; font-weight: bold;">not</span> <span style="color: #3a81c3;">isinstance</span><span style="color: #3a81c3;">(</span>x, ignore_types<span style="color: #3a81c3;">)</span>:
            <span style="color: #3a81c3; font-weight: bold;">yield</span> <span style="color: #3a81c3; font-weight: bold;">from</span> flatten<span style="color: #3a81c3;">(</span>x<span style="color: #3a81c3;">)</span>
        <span style="color: #3a81c3; font-weight: bold;">else</span>:
            <span style="color: #3a81c3; font-weight: bold;">yield</span> x

<span style="color: #715ab1;">items</span> = <span style="color: #3a81c3;">[</span><span style="color: #2d9574;">'Dave'</span>, <span style="color: #2d9574;">'Paula'</span>, <span style="color: #6c3163;">[</span><span style="color: #2d9574;">'Thomas'</span>, <span style="color: #2d9574;">'Lewis'</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">]</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> x <span style="color: #3a81c3; font-weight: bold;">in</span> flatten<span style="color: #3a81c3;">(</span>items<span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>x<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org348423e" class="outline-3">
<h3 id="org348423e"><span class="section-number-3">5.8</span> Merge Two Sorted Iterables</h3>
<div class="outline-text-3" id="text-5-8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> heapq
<span style="color: #715ab1;">a</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span>, <span style="color: #4e3163;">4</span>, <span style="color: #4e3163;">7</span>, <span style="color: #4e3163;">10</span><span style="color: #3a81c3;">]</span>
<span style="color: #715ab1;">b</span> = <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">2</span>, <span style="color: #4e3163;">5</span>, <span style="color: #4e3163;">6</span>, <span style="color: #4e3163;">11</span><span style="color: #3a81c3;">]</span>
<span style="color: #3a81c3; font-weight: bold;">for</span> c <span style="color: #3a81c3; font-weight: bold;">in</span> heapq.merge<span style="color: #3a81c3;">(</span>a, b<span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>c<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org76b1e25" class="outline-3">
<h3 id="org76b1e25"><span class="section-number-3">5.9</span> <code>iter()</code></h3>
<div class="outline-text-3" id="text-5-9">
<p>
<a id="org611d79a"></a>
<code>iter()</code> optionally accepts a zero-argument <b>callable</b> and <b>sentinel</b> (terminating) value as inputs.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">for</span> chunk <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3;">iter</span><span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">lambda</span>: fs.read<span style="color: #6c3163;">(</span><span style="color: #4e3163;">10</span><span style="color: #6c3163;">)</span>, <span style="color: #2d9574;">''</span><span style="color: #3a81c3;">)</span>:
    <span style="color: #3a81c3; font-weight: bold;">print</span><span style="color: #3a81c3;">(</span>chunk<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org81656d4" class="outline-2">
<h2 id="org81656d4"><span class="section-number-2">6</span> I/O</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgc1071de" class="outline-3">
<h3 id="orgc1071de"><span class="section-number-3">6.1</span> Encoding</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">with</span> <span style="color: #3a81c3;">open</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'somefile.txt'</span>, <span style="color: #2d9574;">'rt'</span>, encoding=<span style="color: #2d9574;">'latin-1'</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3; font-weight: bold;">as</span> f:
    ...
</pre>
</div>
<p>
<b>latin-1</b> encoding is notable in that it will never produce a decoding error when reading text of a possibly unknown encoding.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Replace bad chars with Unicode U+fffd replacement char</span>
<span style="color: #3a81c3;">open</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'sample.txt'</span>, <span style="color: #2d9574;">'rt'</span>, encoding=<span style="color: #2d9574;">'ascii'</span>, errors=<span style="color: #2d9574;">'replace'</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Ignore bad chars entirely</span>
<span style="color: #3a81c3;">open</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'sample.txt'</span>, <span style="color: #2d9574;">'rt'</span>, encoding=<span style="color: #2d9574;">'ascii'</span>, errors=<span style="color: #2d9574;">'ignore'</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org55a7fa5" class="outline-3">
<h3 id="org55a7fa5"><span class="section-number-3">6.2</span> <code>readinto</code></h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">import</span> array
<span style="color: #715ab1;">a</span> = array.array<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'i'</span>, <span style="color: #6c3163;">[</span><span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span>, <span style="color: #4e3163;">0</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">with</span> <span style="color: #3a81c3;">open</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'data.bin'</span>, <span style="color: #2d9574;">'rb'</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3; font-weight: bold;">as</span> f:
    f.readinto<span style="color: #3a81c3;">(</span>a<span style="color: #3a81c3;">)</span>
</pre>
</div>
<p>
<code>readinto()</code> fills the contents of an existing buffer
</p>
<ul class="org-ul">
<li>One caution with using <code>f.readinto()~</code> is that you must always make sure to check its return code, which is the number of bytes actually read.</li>
</ul>
</div>
</div>
<div id="outline-container-org2cf6020" class="outline-3">
<h3 id="org2cf6020"><span class="section-number-3">6.3</span> <code>io.StringIO</code>, <code>io.BytesIO</code></h3>
</div>
<div id="outline-container-orgac974ba" class="outline-3">
<h3 id="orgac974ba"><span class="section-number-3">6.4</span> <code>gzip.open</code>, <code>bz2.open</code></h3>
</div>
<div id="outline-container-orgeaaa849" class="outline-3">
<h3 id="orgeaaa849"><span class="section-number-3">6.5</span> Iterating Over Fixed-Sized Records</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #3a81c3; font-weight: bold;">from</span> functools <span style="color: #3a81c3; font-weight: bold;">import</span> partial

<span style="color: #715ab1;">RECORD_SIZE</span> = <span style="color: #4e3163;">32</span>

<span style="color: #3a81c3; font-weight: bold;">with</span> <span style="color: #3a81c3;">open</span><span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'somefile.data'</span>, <span style="color: #2d9574;">'rb'</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3; font-weight: bold;">as</span> f:
    <span style="color: #715ab1;">records</span> = <span style="color: #3a81c3;">iter</span><span style="color: #3a81c3;">(</span>partial<span style="color: #6c3163;">(</span>f.read, RECORD_SIZE<span style="color: #6c3163;">)</span>, b<span style="color: #2d9574;">''</span><span style="color: #3a81c3;">)</span>
    <span style="color: #3a81c3; font-weight: bold;">for</span> r <span style="color: #3a81c3; font-weight: bold;">in</span> records:
        ...
</pre>
</div>
<ul class="org-ul">
<li><a href="#org611d79a">5.9</a></li>
</ul>
</div>
</div>

<div id="outline-container-org20e592a" class="outline-3">
<h3 id="org20e592a"><span class="section-number-3">6.6</span> <code>nmap</code></h3>
<div class="outline-text-3" id="text-6-6">
<p>
Use the mmap module to memory map files for random access to its contents or to make in-place modifications.
</p>
</div>
</div>

<div id="outline-container-orge64237f" class="outline-3">
<h3 id="orge64237f"><span class="section-number-3">6.7</span> <code>memoryview</code></h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #715ab1;">buf</span> = <span style="color: #3a81c3;">bytearray</span><span style="color: #3a81c3;">(</span>b<span style="color: #2d9574;">'Hello World'</span><span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">m1</span> = <span style="color: #3a81c3;">memoryview</span><span style="color: #3a81c3;">(</span>buf<span style="color: #3a81c3;">)</span>
<span style="color: #715ab1;">m2</span> = m1<span style="color: #3a81c3;">[</span>-<span style="color: #4e3163;">5</span>:<span style="color: #3a81c3;">]</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">m2=&gt; &lt;memory at 0x100681390&gt;</span>
<span style="color: #715ab1;">m2</span><span style="color: #3a81c3;">[</span>:<span style="color: #3a81c3;">]</span> = b<span style="color: #2d9574;">'WORLD'</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">#</span><span style="color: #2aa1ae; background-color: #ecf3ec;">buf=&gt; bytearray(b'Hello WORLD')</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
